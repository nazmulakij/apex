DECLARE
CURSOR C1 IS
SELECT ID, MEAL_COUNT
FROM CAFETERIA_DETAILS
-- UPDATE CAFETERIA_DETAILS SET MEAL_COUNT = 0
WHERE MEAL_DATE IN ('13-JUL-2024', '17-JUL-2024', '20-JUL-2024', '21-JUL-2024', '22-JUL-2024', '23-JUL-2024')
ORDER BY ID DESC;
BEGIN
FOR I IN C1 LOOP
PRC_SQL_MEAL_INSERT(P_MEAL_ID => I.ID, P_STATUS => 2);
COMMIT;
END LOOP;
END; DECLARE
CURSOR C1 IS
SELECT ID, MEAL_COUNT
FROM CAFETERIA_DETAILS
-- UPDATE CAFETERIA_DETAILS SET MEAL_COUNT = 0
WHERE MEAL_DATE IN ('13-JUL-2024', '17-JUL-2024', '20-JUL-2024', '21-JUL-2024', '22-JUL-2024', '23-JUL-2024')
ORDER BY ID DESC;
BEGIN
FOR I IN C1 LOOP
PRC_SQL_MEAL_INSERT(P_MEAL_ID => I.ID, P_STATUS => 2);
COMMIT;
END LOOP;
END;


SQL PROCEDURE 

CALL srpSqlMealDataInser



DECLARE
    CURSOR c_cafeteria IS
        SELECT EMP_ID, MEAL_DATE, MEAL_COUNT, MEAL_SPEND, MEAL_GUEST,
               IS_PAYABLE, NARATION, CREATED_BY, CREATED_ON,
               MANUAL_ENTRY, MEALFOR, CATERING_ID
        FROM CAFETERIA_DETAILS_VW
        WHERE MEAL_DATE BETWEEN TO_DATE('01-MAY-2025', 'DD-MON-YYYY') AND TO_DATE('31-MAY-2025', 'DD-MON-YYYY')
        AND EMP_ID = 533280
        ORDER BY MEAL_DATE DESC;

    v_new_id NUMBER;

BEGIN
    -- Get the current max ID from the remote table
    SELECT NVL(MAX(ID), 0)
    INTO v_new_id
    FROM ABL_PMIS.CAFETERIA_DETAILS@ABLPMIS_DBLINK;

    -- Loop through cursor rows
    FOR rec IN c_cafeteria LOOP
        v_new_id := v_new_id + 1;

        INSERT INTO ABL_PMIS.CAFETERIA_DETAILS@ABLPMIS_DBLINK (
            ID, EMP_ID, MEAL_DATE, MEAL_COUNT, MEAL_SPEND, MEAL_GUEST,
            IS_PAYABLE, NARATION, CREATED_BY, CREATED_ON, MANUAL_ENTRY,
            MEALFOR, CATERING_ID
        ) VALUES (
            v_new_id, rec.EMP_ID, rec.MEAL_DATE, rec.MEAL_COUNT, rec.MEAL_SPEND, rec.MEAL_GUEST,
            rec.IS_PAYABLE, rec.NARATION, rec.CREATED_BY, rec.CREATED_ON, rec.MANUAL_ENTRY,
            rec.MEALFOR, rec.CATERING_ID
        );
    END LOOP;

    COMMIT;
END;
/